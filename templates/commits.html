<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <title>Commits par minute</title>
    <script
      type="text/javascript"
      src="https://www.gstatic.com/charts/loader.js"
    ></script>
  </head>
  <body>
    <h2 style="text-align:center;">Activité des commits (par minute)</h2>
    <div id="commits_chart" style="width: 100%; height: 500px;"></div>

    <script>
      // Charger Google Charts
      google.charts.load("current", { packages: ["corechart"] });
      google.charts.setOnLoadCallback(initChart);

      function initChart() {
        // Récupérer les données depuis notre API Flask /commits-data/
        fetch("/commits-data/")
          .then((response) => response.json())
          .then((data) => {
            drawChart(data);
          });
      }

      function drawChart(data) {
        var dataTable = new google.visualization.DataTable();
        dataTable.addColumn("number", "Minute");
        dataTable.addColumn("number", "Nombre de commits");

        // Remplir la DataTable avec les minutes et les compteurs
        data.results.forEach((entry) => {
          dataTable.addRow([entry.minute, entry.count]);
        });

        var options = {
          title: "Nombre de commits par minute (dépôt OpenRSI/5MCSI_Metriques)",
          legend: { position: "none" },
          hAxis: { title: "Minute (0 à 59)" },
          vAxis: { title: "Nombre de commits" },
          bar: { groupWidth: "80%" }
        };

        var chart = new google.visualization.ColumnChart(
          document.getElementById("commits_chart")
        );
        chart.draw(dataTable, options);
      }
    </script>
  </body>
</html>

